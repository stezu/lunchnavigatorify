extends layout

block content
    h1= title
    p Welcome to #{title}

    form(class='yelp-search', action='/search', method='post')
        fieldset
            label(class='yelp-search__field') Search
                input(name='restaurant', type='search')
        div
            input(type='submit', value='submit')

    block results

block footerjs
    script(type="text/javascript").

        function restaurantFormatResult (restaurant) {
            var markup = "<table class='restaurant-result'><tr>";
            if (restaurant.image_url !== undefined) {
                markup += "<td class='restaurant-image'><img src='" + restaurant.image_url + "'/></td>";
            }
            markup += "<td class='restaurant-info'><div class='restaurant-name'>" + restaurant.name + "</div>";
            if (restaurant.rating !== undefined) {
                markup += "<div class='restaurant-rating'>" + restaurant.rating + "</div>";
            }
            markup += "</td></tr></table>";
            return markup;
        }

        function restaurantFormatSelection (restaurant) {
            return restaurant.name;
        }
        jQuery(function($) {
            $('.yelp-search__field input').select2({
                placeholder: "Search for a restaurant",
                minimumInputLength: 2,
                ajax: {
                    url: "/search",
                    data: function (term, page) {
                        return {
                            restaurant: term,
                            'page_limit': 10
                        };
                    },
                    results: function (data, page) {
                        return {results: data.businesses};
                    }
                },
                formatResult: restaurantFormatResult, // omitted for brevity, see the source of this page
                formatSelection: restaurantFormatSelection,  // omitted for brevity, see the source of this page
                dropdownCssClass: "bigdrop", // apply css that makes the dropdown taller
                escapeMarkup: function (m) { return m; } // we do not want to escape markup since we are displaying html in results
            });
        });
